<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>WoW Classic / TBC ‚Äì Schandtatenliste</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&display=swap" rel="stylesheet">
<style>
body {margin:0; font-family:'Cinzel',serif; background:radial-gradient(circle at top,#2b1d0e,#0d0a06); color:#f5e6c8;}
.container{max-width:1300px; margin:30px auto; padding:30px; background:linear-gradient(180deg,rgba(20,14,7,.95),rgba(10,7,3,.98)); border:6px solid #c9a44c; border-radius:14px;}
h1{text-align:center;color:#ffd36a;margin-bottom:20px;}
input,select,button{padding:10px; background:#120c05; border:2px solid #9c7c3f; color:#f5e6c8; border-radius:6px; font-family:inherit;}
button{cursor:pointer; background:linear-gradient(to bottom,#e0b75a,#8a6b2f); color:#1b1206; font-weight:bold;}
.form,.filters{display:flex; flex-wrap:wrap; gap:10px;}
.form-full{width:100%; margin-top:10px;}
#crimeInput{width:100%;}
.form-buttons{display:flex; justify-content:center; gap:12px; margin:12px 0;}
.list{margin-top:30px;}
.entry{display:grid; grid-template-columns:44px 44px 1fr 170px; gap:12px; align-items:center; padding:12px; background:linear-gradient(180deg,#1a1208,#0d0904); border:2px solid #8c6a32; border-left:8px solid; border-radius:8px; margin-bottom:10px;}
.icon{width:40px;height:40px;background-size:cover;background-position:center;border:2px solid #c9a44c;border-radius:4px;}
.voteBox{display:flex; align-items:center; justify-content:flex-end; gap:6px;}
.voteBtn{font-size:20px; cursor:pointer; opacity:0.5; transition:transform .1s,opacity .1s;}
.voteBtn:hover{transform:scale(1.2);opacity:1;}
.voteBtn.active.up{color:#4CAF50;opacity:1;}
.voteBtn.active.down{color:#E53935;opacity:1;}
.voteCount{min-width:20px;text-align:center;}
#adminPanel{margin-top:20px;background:#1a1208;padding:10px;border-radius:8px;border:2px solid #8c6a32;display:none;}
.adminUser{display:flex; justify-content:space-between; margin-bottom:6px;}
.adminUser button{padding:2px 6px;font-size:0.8em;}
</style>
</head>
<body>
<div class="container">
<h1>WoW Classic / TBC ‚Äì Schandtatenliste</h1>

<!-- LOGIN PANEL -->
<div id="loginPanel">
  <input type="email" id="emailInput" placeholder="Email"><br><br>
  <input type="password" id="passwordInput" placeholder="Passwort"><br><br>
  <button id="registerBtn">Registrieren</button>
  <button id="loginBtn">Login</button>
</div>

<!-- MAIN CONTENT -->
<div id="mainContent" style="display:none;">
  <div class="filters">
    <input id="searchInput" placeholder="Suche...">
    <select id="filterRace"><option value="">Alle Rassen</option><option>Mensch</option><option>Zwerg</option><option>Nachtelf</option><option>Gnom</option><option>Draenei</option><option>Ork</option><option>Troll</option><option>Tauren</option><option>Untoter</option><option>Blutelf</option></select>
    <select id="filterClass"><option value="">Alle Klassen</option><option>Krieger</option><option>Paladin</option><option>J√§ger</option><option>Schurke</option><option>Priester</option><option>Schamane</option><option>Magier</option><option>Hexenmeister</option><option>Druide</option></select>
  </div>

  <div class="form">
    <input id="nameInput" placeholder="Name">
    <select id="raceInput"><option value="">Rasse</option><option>Mensch</option><option>Zwerg</option><option>Nachtelf</option><option>Ork</option><option>Untoter</option><option>Tauren</option><option>Blutelf</option></select>
    <select id="classInput"><option value="">Klasse</option><option>Krieger</option><option>Magier</option><option>Priester</option><option>Schurke</option><option>J√§ger</option><option>Hexenmeister</option><option>Druide</option><option>Paladin</option><option>Schamane</option></select>
  </div>
  <div class="form-full">
    <input id="crimeInput" placeholder="Schandtat">
  </div>
  <div class="form-buttons">
    <button id="addBtn">Hinzuf√ºgen</button>
    <button id="logoutBtn">Logout</button>
  </div>

  <div id="list" class="list"></div>

  <div id="adminPanel">
    <h3>Pending-User Freischalten</h3>
    <div id="pendingList"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, doc, getDoc, getDocs, updateDoc, deleteDoc, setDoc, increment, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

/* Firebase Config */
const firebaseConfig = {
apiKey: "AIzaSyBOko8Wg-jCvz7aRPleNcbJCm8u2CYtjps",
authDomain: "wow-hs-liste.firebaseapp.com",
projectId: "wow-hs-liste",
storageBucket: "wow-hs-liste.firebasestorage.app",
messagingSenderId: "180764359810",
appId: "1:180764359810:web:03cef19546dcc32081889b"
};


const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* Klassen / Rassen */
const initialClassData = { /* wie vorher */ };
const raceIcons = { /* wie vorher */ };

/* DOM */
const emailInput=document.getElementById("emailInput");
const passwordInput=document.getElementById("passwordInput");
const loginPanel=document.getElementById("loginPanel");
const mainContent=document.getElementById("mainContent");
const nameInput=document.getElementById("nameInput");
const raceInput=document.getElementById("raceInput");
const classInput=document.getElementById("classInput");
const crimeInputEl=document.getElementById("crimeInput");
const listEl=document.getElementById("list");
const searchInput=document.getElementById("searchInput");
const filterRace=document.getElementById("filterRace");
const filterClass=document.getElementById("filterClass");
const adminPanel=document.getElementById("adminPanel");
const pendingList=document.getElementById("pendingList");

/* REGISTER */
document.getElementById("registerBtn").onclick=async()=>{
  try{
    const cred=await createUserWithEmailAndPassword(auth,emailInput.value,passwordInput.value);
    await setDoc(doc(db,"users",cred.user.uid),{email:emailInput.value,role:"pending"});
    alert("Registriert ‚Äì Admin muss freischalten"); signOut(auth);
  }catch(e){alert(e.message);}
};

/* LOGIN/LOGOUT */
document.getElementById("loginBtn").onclick=()=>signInWithEmailAndPassword(auth,emailInput.value,passwordInput.value).catch(e=>alert(e.message));
document.getElementById("logoutBtn").onclick=()=>signOut(auth);

/* AUTH STATE */
let entries=[];
onAuthStateChanged(auth, async user=>{
  if(!user){loginPanel.style.display="block"; mainContent.style.display="none"; return;}
  const snap = await getDoc(doc(db,"users",user.uid));
  if(!snap.exists()||snap.data().role==="pending"){alert("Noch nicht freigeschaltet"); signOut(auth); return;}
  loginPanel.style.display="none"; mainContent.style.display="block";
  if(snap.data().role==="admin"){adminPanel.style.display="block"; loadPending();} else{adminPanel.style.display="none";}
  loadEntries();
});

/* ADD ENTRY */
document.getElementById("addBtn").onclick=async()=>{
  const user=auth.currentUser;
  if(!user||!nameInput.value||!raceInput.value||!classInput.value||!crimeInputEl.value){alert("Alle Felder ausf√ºllen"); return;}
  await addDoc(collection(db,"entries"),{
    uid:user.uid,
    name:nameInput.value,
    race:raceInput.value,
    class:classInput.value,
    crime:crimeInputEl.value,
    role:initialClassData[classInput.value].role,
    upvotes:0,
    downvotes:0,
    createdAt:serverTimestamp()
  });
  nameInput.value = raceInput.value = classInput.value = crimeInputEl.value = "";
};

/* LOAD / RENDER */
function loadEntries(){onSnapshot(query(collection(db,"entries"),orderBy("createdAt")),snap=>{entries=snap.docs.map(d=>({id:d.id,...d.data()})); render();});}
async function render(){
  listEl.innerHTML=""; const user=auth.currentUser; const s=searchInput.value.toLowerCase();
  for(const e of entries){
    if((filterRace.value&&e.race!==filterRace.value)||(filterClass.value&&e.class!==filterClass.value)||!(e.name+e.race+e.class+e.crime).toLowerCase().includes(s)) continue;
    let voteType=null; if(user){const vSnap=await getDoc(doc(db,"entries",e.id,"votes",user.uid)); if(vSnap.exists()) voteType=vSnap.data().type;}
    const div=document.createElement("div"); div.className="entry"; div.style.borderLeftColor=initialClassData[e.class].color;
    div.innerHTML=`
      <div class="icon" style="background-image:url(${raceIcons[e.race]||""})"></div>
      <div class="icon" style="background-image:url(${initialClassData[e.class].icon||""})"></div>
      <div><strong>${e.name}</strong><br>${e.race} / ${e.class}<br><small>Schandtat: ${e.crime}</small></div>
      <div class="voteBox">
        <span class="voteBtn ${voteType==="up"?"active up":""}" onclick="vote('${e.id}','up')">üëç</span>
        <span class="voteCount">${e.upvotes||0}</span>
        <span class="voteBtn ${voteType==="down"?"active down":""}" onclick="vote('${e.id}','down')">üëé</span>
        <span class="voteCount">${e.downvotes||0}</span>
      </div>
      <button onclick="editEntry('${e.id}','${e.name}','${e.race}','${e.class}','${e.crime}')">‚úèÔ∏è</button>
      <button onclick="deleteEntry('${e.id}')">üóë</button>
    `;
    listEl.appendChild(div);
  }
}

/* EDIT / DELETE / VOTE */
window.editEntry=async(id,name,raceVal,classVal,crime)=>{
  const newName=prompt("Neuer Name:",name); const newRace=prompt("Neue Rasse:",raceVal);
  const newClass=prompt("Neue Klasse:",classVal); const newCrime=prompt("Neue Schandtat:",crime);
  if(newName&&newRace&&newClass&&newCrime){await updateDoc(doc(db,"entries",id),{name:newName,race:newRace,class:newClass,crime:newCrime,role:initialClassData[newClass].role}); render();}
};
window.deleteEntry=async(id)=>{if(confirm("Eintrag l√∂schen?")) await deleteDoc(doc(db,"entries",id)); render();}
window.vote=async(id,type)=>{const user=auth.currentUser;if(!user){alert("Bitte einloggen"); return;} const voteRef=doc(db,"entries",id,"votes",user.uid); const entryRef=doc(db,"entries",id); const snap=await getDoc(voteRef); if(!snap.exists()){await setDoc(voteRef,{type}); await updateDoc(entryRef,{[type==="up"?"upvotes":"downvotes"]:increment(1)});} else {const old=snap.data().type;if(old===type) return; await updateDoc(voteRef,{type}); await updateDoc(entryRef,{[old==="up"?"upvotes":"downvotes"]:increment(-1),[type==="up"?"upvotes":"downvotes"]:increment(1)});} render();};

/* ADMIN */
async function loadPending(){pendingList.innerHTML=""; const snaps=await getDocs(collection(db,"users")); snaps.forEach(d=>{const u=d.data(); if(u.role==="pending"){const div=document.createElement("div"); div.className="adminUser"; div.innerHTML=`${u.email} <button onclick="approveUser('${d.id}')">Freischalten</button>`; pendingList.appendChild(div);}});}
window.approveUser=async(uid)=>{await updateDoc(doc(db,"users",uid),{role:"user"}); loadPending();}

/* FILTERS */
searchInput.oninput=filterRace.onchange=filterClass.onchange=render;
</script>
</div>
</body>
</html>

