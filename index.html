<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>WoW Classic / TBC ‚Äì Schandtatenliste</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Cinzel',serif;
  background:radial-gradient(circle at top,#2b1d0e,#0d0a06);
  color:#f5e6c8;
}
.container{
  max-width:1300px;
  margin:30px auto;
  padding:30px;
  background:linear-gradient(180deg,rgba(20,14,7,.95),rgba(10,7,3,.98));
  border:6px solid #c9a44c;
  border-radius:14px;
}
h1{text-align:center;color:#ffd36a}

input,select,button{
  padding:10px;
  background:#120c05;
  border:2px solid #9c7c3f;
  color:#f5e6c8;
  border-radius:6px;
  font-family:inherit;
}
button{
  cursor:pointer;
  background:linear-gradient(to bottom,#e0b75a,#8a6b2f);
  color:#1b1206;
  font-weight:bold;
}

.form,.filters{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}
.form-full{width:100%;margin-top:10px}
#crime{width:100%}

.form-buttons{
  display:flex;
  justify-content:center;
  gap:12px;
  margin:12px 0;
}

.entry{
  display:grid;
  grid-template-columns:44px 44px 1fr 170px;
  gap:12px;
  align-items:center;
  padding:12px;
  background:linear-gradient(180deg,#1a1208,#0d0904);
  border:2px solid #8c6a32;
  border-left:8px solid;
  border-radius:8px;
  margin-bottom:10px;
}

.icon{
  width:40px;
  height:40px;
  background-size:cover;
  background-position:center;
  border:2px solid #c9a44c;
  border-radius:4px;
}

.voteBox{
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap:6px;
}
.voteBtn{
  font-size:20px;
  cursor:pointer;
  opacity:0.5;
  transition:transform .1s,opacity .1s;
}
.voteBtn:hover{
  transform:scale(1.2);
  opacity:1;
}
.voteBtn.active.up{color:#4CAF50;opacity:1}
.voteBtn.active.down{color:#E53935;opacity:1}
.voteCount{min-width:20px;text-align:center}
</style>
</head>

<body>
<div class="container">

<h1>WoW Classic / TBC ‚Äì Schandtatenliste</h1>

<!-- FILTER / SEARCH -->
<div class="filters">
  <input id="search" placeholder="Suche...">
  <select id="filterRace">
    <option value="">Alle Rassen</option>
    <option>Mensch</option><option>Zwerg</option><option>Nachtelf</option>
    <option>Gnom</option><option>Draenei</option>
    <option>Ork</option><option>Troll</option><option>Tauren</option>
    <option>Untoter</option><option>Blutelf</option>
  </select>
  <select id="filterClass">
    <option value="">Alle Klassen</option>
    <option>Krieger</option><option>Paladin</option><option>J√§ger</option>
    <option>Schurke</option><option>Priester</option><option>Schamane</option>
    <option>Magier</option><option>Hexenmeister</option><option>Druide</option>
  </select>
</div>

<!-- ADD ENTRY -->
<div class="form">
  <input id="name" placeholder="Name">
  <select id="race"><option value="">Rasse</option>
    <option>Mensch</option><option>Zwerg</option><option>Nachtelf</option>
    <option>Gnom</option><option>Draenei</option>
    <option>Ork</option><option>Troll</option><option>Tauren</option>
    <option>Untoter</option><option>Blutelf</option>
  </select>
  <select id="wowClass"><option value="">Klasse</option>
    <option>Krieger</option><option>Paladin</option><option>J√§ger</option>
    <option>Schurke</option><option>Priester</option><option>Schamane</option>
    <option>Magier</option><option>Hexenmeister</option><option>Druide</option>
  </select>
</div>
<div class="form-full">
  <input id="crime" placeholder="Schandtat">
</div>
<div class="form-buttons">
  <button id="addBtn">Hinzuf√ºgen</button>
</div>

<div id="list"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import {
  getFirestore, collection, addDoc, query, orderBy, onSnapshot,
  serverTimestamp, doc, updateDoc, increment, getDoc, setDoc
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

/* üî• Firebase Config */
const firebaseConfig = {
  apiKey:"DEIN_API_KEY",
  authDomain:"DEIN_PROJECT.firebaseapp.com",
  projectId:"DEIN_PROJECT_ID",
  appId:"DEINE_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const list = document.getElementById("list");
const search = document.getElementById("search");
const filterRace = document.getElementById("filterRace");
const filterClass = document.getElementById("filterClass");

let entries = [];

/* ADD ENTRY */
addBtn.onclick = async()=>{
  if(!name.value||!race.value||!wowClass.value||!crime.value) return;
  await addDoc(collection(db,"entries"),{
    name:name.value,
    race:race.value,
    class:wowClass.value,
    crime:crime.value,
    upvotes:0,
    downvotes:0,
    createdAt:serverTimestamp()
  });
  name.value = crime.value = "";
};

/* LOAD */
onSnapshot(query(collection(db,"entries"),orderBy("createdAt")),(snap)=>{
  entries = snap.docs.map(d=>({id:d.id,...d.data()}));
  render();
});

search.oninput = filterRace.onchange = filterClass.onchange = render;

/* RENDER */
async function render(){
  list.innerHTML="";
  const user = auth.currentUser;
  const s = search.value.toLowerCase();

  for(const e of entries){
    if(
      (filterRace.value && e.race!==filterRace.value) ||
      (filterClass.value && e.class!==filterClass.value) ||
      !(e.name+e.race+e.class+e.crime).toLowerCase().includes(s)
    ) continue;

    let voteType=null;
    if(user){
      const v = await getDoc(doc(db,"entries",e.id,"votes",user.uid));
      if(v.exists()) voteType=v.data().type;
    }

    const div=document.createElement("div");
    div.className="entry";
    div.innerHTML=`
      <div class="icon"></div>
      <div class="icon"></div>
      <div>
        <b>${e.name}</b><br>
        ${e.race} / ${e.class}<br>
        <small>Schandtat: ${e.crime}</small>
      </div>
      <div class="voteBox">
        <span class="voteBtn ${voteType==="up"?"active up":""}"
          onclick="vote('${e.id}','up')">üëç</span>
        <span class="voteCount">${e.upvotes||0}</span>
        <span class="voteBtn ${voteType==="down"?"active down":""}"
          onclick="vote('${e.id}','down')">üëé</span>
        <span class="voteCount">${e.downvotes||0}</span>
      </div>
    `;
    list.appendChild(div);
  }
}

/* VOTE ‚Äì 1 pro User */
window.vote = async(id,type)=>{
  const user = auth.currentUser;
  if(!user){ alert("Bitte einloggen"); return; }

  const voteRef = doc(db,"entries",id,"votes",user.uid);
  const entryRef = doc(db,"entries",id);
  const snap = await getDoc(voteRef);

  if(!snap.exists()){
    await setDoc(voteRef,{type});
    await updateDoc(entryRef,{
      [type==="up"?"upvotes":"downvotes"]: increment(1)
    });
  }else{
    const old = snap.data().type;
    if(old===type) return;
    await updateDoc(voteRef,{type});
    await updateDoc(entryRef,{
      [old==="up"?"upvotes":"downvotes"]: increment(-1),
      [type==="up"?"upvotes":"downvotes"]: increment(1)
    });
  }
  render();
};
</script>

</div>
</body>
</html>
