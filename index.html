<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>WoW Classic / TBC ‚Äì Schandtatenliste</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&display=swap" rel="stylesheet">

<style>
/* ================= GLOBAL ================= */
body{
  margin:0;
  font-family:'Cinzel',serif;
  color:#f5e6c8;
  background:
    url("https://images.blz-contentstack.com/v3/assets/blt3452e3b114fab0cd/blt8c8fba8b1a9a7f17/602d9f93f5dc6b0edee1bb1b/tbc-bg.jpg")
    center/cover fixed no-repeat,
    radial-gradient(circle at top,#2b1d0e,#0d0a06);
}

.container{
  max-width:1400px;
  margin:30px auto;
  padding:30px;
  background:rgba(10,7,3,.93);
  border:6px solid #c9a44c;
  border-radius:18px;
  box-shadow:0 0 40px rgba(0,0,0,.9);
}

h1{
  text-align:center;
  color:#ffd36a;
  text-shadow:0 0 10px #000;
}

/* ================= INPUTS ================= */
input,select,button{
  padding:10px;
  background:#120c05;
  border:2px solid #9c7c3f;
  color:#f5e6c8;
  border-radius:6px;
  font-family:inherit;
}

button{
  cursor:pointer;
  background:linear-gradient(#e0b75a,#8a6b2f);
  color:#1b1206;
  font-weight:bold;
  box-shadow:inset 0 1px 0 #fff4c2;
}

button:hover{filter:brightness(1.15);}

/* ================= LOGIN ================= */
#loginPanel{
  max-width:420px;
  margin:100px auto;
  padding:25px;
  background:#1a1208;
  border-radius:14px;
  border:3px solid #8c6a32;
}

/* ================= FILTER ================= */
.filters{
  display:flex;
  gap:10px;
  margin-bottom:16px;
}

/* ================= ENTRY ================= */
.entry{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:16px;
  padding:14px;
  margin-bottom:14px;
  background:linear-gradient(180deg,#1a1208,#0d0904);
  border:2px solid #8c6a32;
  border-left:8px solid;
  border-radius:14px;
}

.entry-left{
  display:flex;
  align-items:center;
  gap:10px;
  flex:1;
}

.icon{
  width:42px;
  height:42px;
  background-size:cover;
  background-position:center;
  border:2px solid #c9a44c;
  border-radius:6px;
}

.entry-text small{opacity:.9}

/* ================= VOTES ================= */
.voteColumn{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:6px;
  min-width:90px;
}

.voteRow{
  display:flex;
  align-items:center;
  gap:6px;
}

.voteBtn{
  font-size:20px;
  cursor:pointer;
  opacity:.5;
  transition:.15s;
}

.voteBtn:hover{transform:scale(1.25);opacity:1;}
.voteBtn.up.active{color:#4CAF50;opacity:1;}
.voteBtn.down.active{color:#E53935;opacity:1;}

.voteCount{min-width:18px;text-align:center;}

/* ================= ACTIONS ================= */
.actionBtns{
  display:flex;
  gap:6px;
}

.actionBtns button{
  font-size:.65em;
  padding:4px 8px;
}

/* ================= ADMIN ================= */
#adminPanel{
  margin-top:25px;
  padding:12px;
  background:#1a1208;
  border:2px solid #8c6a32;
  border-radius:10px;
}

/* ================= TOOLTIP ================= */
.wow-tooltip{
  position:absolute;
  background:linear-gradient(#1c1409,#0b0703);
  border:2px solid #c9a44c;
  border-radius:6px;
  padding:8px 10px;
  color:#ffd36a;
  font-size:12px;
  box-shadow:0 0 20px #000;
  pointer-events:none;
  z-index:9999;
  opacity:0;
  transition:.15s;
}

/* ================= ANIM ================= */
@keyframes votePulse{
  0%{transform:scale(1)}
  50%{transform:scale(1.4)}
  100%{transform:scale(1)}
}
.voteBtn.voted{animation:votePulse .25s ease-out}
</style>
</head>

<body>
<div class="container">
<h1>WoW Classic / TBC ‚Äì Schandtatenliste</h1>

<!-- LOGIN -->
<div id="loginPanel">
  <input id="email" placeholder="Email"><br><br>
  <input id="password" type="password" placeholder="Passwort"><br><br>
  <button id="loginBtn">Login</button>
  <button id="registerBtn">Registrieren</button>
</div>

<!-- MAIN -->
<div id="main" style="display:none">

  <div class="filters">
    <input id="search" placeholder="Suche‚Ä¶">
    <select id="filterRace"><option value="">Alle Rassen</option></select>
    <select id="filterClass"><option value="">Alle Klassen</option></select>
  </div>

  <div id="list"></div>

  <div id="adminPanel" style="display:none">
    <h3>Pending User</h3>
    <div id="pendingList"></div>
  </div>

</div>
</div>

<div id="tooltip" class="wow-tooltip"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, addDoc, doc, getDoc, setDoc, updateDoc, deleteDoc, onSnapshot, increment } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

/* ===== FIREBASE ===== */
const firebaseConfig={
 apiKey:"AIzaSyBOko8Wg-jCvz7aRPleNcbJCm8u2CYtjps",
 authDomain:"wow-hs-liste.firebaseapp.com",
 projectId:"wow-hs-liste",
 storageBucket:"wow-hs-liste.appspot.com",
 messagingSenderId:"180764359810",
 appId:"1:180764359810:web:03cef19546dcc32081889b"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

/* ===== ICONS ===== */
const classIcons={
 Krieger:"https://wow.zamimg.com/images/wow/icons/large/class_warrior.jpg",
 Magier:"https://wow.zamimg.com/images/wow/icons/large/class_mage.jpg",
 Priester:"https://wow.zamimg.com/images/wow/icons/large/class_priest.jpg",
 Schurke:"https://wow.zamimg.com/images/wow/icons/large/class_rogue.jpg",
 J√§ger:"https://wow.zamimg.com/images/wow/icons/large/class_hunter.jpg",
 Hexenmeister:"https://wow.zamimg.com/images/wow/icons/large/class_warlock.jpg",
 Druide:"https://wow.zamimg.com/images/wow/icons/large/class_druid.jpg",
 Paladin:"https://wow.zamimg.com/images/wow/icons/large/class_paladin.jpg",
 Schamane:"https://wow.zamimg.com/images/wow/icons/large/class_shaman.jpg"
};

const raceIcons={
 Mensch:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_human_male.jpg",
 Zwerg:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_dwarf_male.jpg",
 Nachtelf:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_nightelf_male.jpg",
 Gnom:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_gnome_male.jpg",
 Draenei:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_draenei_male.jpg",
 Ork:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_orc_male.jpg",
 Troll:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_troll_male.jpg",
 Tauren:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_tauren_male.jpg",
 Untoter:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_undead_male.jpg",
 Blutelf:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_bloodelf_male.jpg"
};

/* ===== TOOLTIP ===== */
const tooltip=document.getElementById("tooltip");
document.addEventListener("mousemove",e=>{
 tooltip.style.left=e.pageX+14+"px";
 tooltip.style.top=e.pageY+14+"px";
});
window.showTip=(t,d)=>{tooltip.innerHTML=`<b>${t}</b><div>${d}</div>`;tooltip.style.opacity=1;}
window.hideTip=()=>tooltip.style.opacity=0;

/* ===== SOUNDS ===== */
const soundUp=new Audio("https://www.myinstants.com/media/sounds/wow-level-up.mp3");
const soundDown=new Audio("https://www.myinstants.com/media/sounds/wow-fail.mp3");

/* ===== AUTH ===== */
loginBtn.onclick=()=>signInWithEmailAndPassword(auth,email.value,password.value);
registerBtn.onclick=()=>createUserWithEmailAndPassword(auth,email.value,password.value);

onAuthStateChanged(auth,u=>{
 document.getElementById("loginPanel").style.display=u?"none":"block";
 document.getElementById("main").style.display=u?"block":"none";
 if(u) loadEntries();
});

/* ===== LOAD ===== */
function loadEntries(){
 onSnapshot(collection(db,"entries"),snap=>{
  list.innerHTML="";
  snap.forEach(d=>{
   const e=d.data();
   const div=document.createElement("div");
   div.className="entry";
   div.innerHTML=`
    <div class="entry-left">
      <div class="icon" style="background-image:url(${raceIcons[e.race]||''})"></div>
      <div class="icon" style="background-image:url(${classIcons[e.class]||''})"></div>
      <div class="entry-text">
        <b>${e.name}</b><br>
        <small>${e.race} / ${e.class}</small><br>
        <small>Schandtat: ${e.crime}</small>
      </div>
    </div>

    <div class="voteColumn">
      <div class="voteRow">
        <span class="voteBtn up" onclick="vote('${d.id}','up',this)" onmouseenter="showTip('Ehre','Upvote')" onmouseleave="hideTip()">üëç</span>
        <span class="voteCount">${e.up||0}</span>
        <span class="voteBtn down" onclick="vote('${d.id}','down',this)" onmouseenter="showTip('Schande','Downvote')" onmouseleave="hideTip()">üëé</span>
        <span class="voteCount">${e.down||0}</span>
      </div>
      <div class="actionBtns">
        <button onclick="deleteDoc(doc(db,'entries','${d.id}'))">üóë</button>
      </div>
    </div>`;
   list.appendChild(div);
  });
 });
}

/* ===== VOTE ===== */
window.vote=async(id,type,btn)=>{
 btn.classList.add("voted");
 setTimeout(()=>btn.classList.remove("voted"),250);
 (type==="up"?soundUp:soundDown).play();
 await updateDoc(doc(db,"entries",id),{[type==="up"?"up":"down"]:increment(1)});
};

// Vote Live
async function vote(id,type){
const user=auth.currentUser;if(!user){alert("Bitte einloggen");return;}
const voteRef=doc(db,"entries",id,"votes",user.uid),entryRef=doc(db,"entries",id);
const snap=await getDoc(voteRef);
if(!snap.exists()){await setDoc(voteRef,{type});await updateDoc(entryRef,{[type==='up'?'upvotes':'downvotes']:increment(1)});}
else{const old=snap.data().type;if(old===type)return;await updateDoc(voteRef,{type});await updateDoc(entryRef,{[old==='up'?'upvotes':'downvotes']:increment(-1),[type==='up'?'upvotes':'downvotes']:increment(1)});}
}

// Edit/Delete
window.editEntry=async(id,name,raceVal,classVal,crime)=>{
const newName=prompt("Neuer Name:",name);const newRace=prompt("Neue Rasse:",raceVal);const newClass=prompt("Neue Klasse:",classVal);const newCrime=prompt("Neue Schandtat:",crime);
if(newName&&newRace&&newClass&&newCrime){await updateDoc(doc(db,"entries",id),{name:newName,race:newRace,class:newClass,crime:newCrime,role:initialClassData[newClass]?.role||""});appendUpdate(`Eintrag bearbeitet: ${newName}`);}
}
window.deleteEntry=async(id)=>{
if(confirm("Eintrag l√∂schen?")){await deleteDoc(doc(db,"entries",id));appendUpdate(`Eintrag gel√∂scht: ${id}`);}
}

// Admin Pending
async function loadPending(){pendingList.innerHTML="";const snaps=await getDocs(collection(db,"users"));snaps.forEach(d=>{const u=d.data();if(u.role==="pending"){const div=document.createElement("div");div.className="adminUser";div.innerHTML=`${u.email} <button onclick="approveUser('${d.id}')">Freischalten</button>`;pendingList.appendChild(div);}});}
window.approveUser=async(uid)=>{await updateDoc(doc(db,"users",uid),{role:"user"}); loadPending();appendUpdate(`User freigeschaltet: ${uid}`);}
</script>
</div>
</body>
</html>










