<html lang="de">
<head>
<meta charset="UTF-8">
<title>WoW Classic ‚Äì Gildenliste</title>
<title>WoW Classic / TBC ‚Äì Schandtatenliste</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&display=swap" rel="stylesheet">

<style>
body { margin:0; font-family:'Cinzel', serif; background: radial-gradient(circle at top, #2b1d0e, #0d0a06); color:#f5e6c8; }
.container { max-width:1200px; margin:40px auto; padding:30px; background:linear-gradient(180deg, rgba(20,14,7,.95), rgba(10,7,3,.98)); border:6px solid #c9a44c; border-radius:14px; }
h1 { text-align:center; color:#ffd36a; margin-bottom:20px; }
input, select, button { padding:10px; background:#120c05; border:2px solid #9c7c3f; color:#f5e6c8; border-radius:6px; font-family:inherit; }
button { cursor:pointer; background:linear-gradient(to bottom,#e0b75a,#8a6b2f); color:#1b1206; font-weight:bold; }
#loginPanel { max-width:400px; margin:20px auto; padding:20px; background:#1a1208; border-radius:12px; }
.form { display:flex; flex-wrap:wrap; gap:12px; margin-bottom:12px; }
.form-full { display:flex; width:100%; }
#crime { flex:1; min-width:100%; }
.form-buttons { display:flex; justify-content:center; gap:12px; margin-top:10px; }
.list { margin-top:30px; }
.entry { display:grid; grid-template-columns:44px 44px 2fr 50px 50px; gap:12px; align-items:flex-start; padding:12px; background:linear-gradient(180deg,#1a1208,#0d0904); border:2px solid #8c6a32; border-left:8px solid; border-radius:8px; }
.icon { width:40px; height:40px; background-size:cover; background-position:center; border:2px solid #c9a44c; border-radius:4px; }
#adminPanel { margin-top:20px; background:#1a1208; padding:10px; border-radius:8px; border:2px solid #8c6a32; display:none; }
.adminUser { display:flex; justify-content:space-between; margin-bottom:6px; }
.adminUser button { padding:2px 6px; font-size:0.8em; }
body{
  margin:0;
  font-family:'Cinzel',serif;
  background:radial-gradient(circle at top,#2b1d0e,#0d0a06);
  color:#f5e6c8;
}
.container{
  max-width:1300px;
  margin:30px auto;
  padding:30px;
  background:linear-gradient(180deg,rgba(20,14,7,.95),rgba(10,7,3,.98));
  border:6px solid #c9a44c;
  border-radius:14px;
}
h1{text-align:center;color:#ffd36a}

input,select,button{
  padding:10px;
  background:#120c05;
  border:2px solid #9c7c3f;
  color:#f5e6c8;
  border-radius:6px;
  font-family:inherit;
}
button{
  cursor:pointer;
  background:linear-gradient(to bottom,#e0b75a,#8a6b2f);
  color:#1b1206;
  font-weight:bold;
}

.form,.filters{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}
.form-full{width:100%;margin-top:10px}
#crime{width:100%}

.form-buttons{
  display:flex;
  justify-content:center;
  gap:12px;
  margin:12px 0;
}

.entry{
  display:grid;
  grid-template-columns:44px 44px 1fr 170px;
  gap:12px;
  align-items:center;
  padding:12px;
  background:linear-gradient(180deg,#1a1208,#0d0904);
  border:2px solid #8c6a32;
  border-left:8px solid;
  border-radius:8px;
  margin-bottom:10px;
}

.icon{
  width:40px;
  height:40px;
  background-size:cover;
  background-position:center;
  border:2px solid #c9a44c;
  border-radius:4px;
}

.voteBox{
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap:6px;
}
.voteBtn{
  font-size:20px;
  cursor:pointer;
  opacity:0.5;
  transition:transform .1s,opacity .1s;
}
.voteBtn:hover{
  transform:scale(1.2);
  opacity:1;
}
.voteBtn.active.up{color:#4CAF50;opacity:1}
.voteBtn.active.down{color:#E53935;opacity:1}
.voteCount{min-width:20px;text-align:center}
</style>
</head>

<body>
<div class="container">
<h1>WoW Classic ‚Äì Hurensohn-Liste</h1>

<div id="loginPanel">
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Passwort">
  <button id="registerBtn">Registrieren</button>
  <button id="loginBtn">Login</button>
<h1>WoW Classic / TBC ‚Äì Schandtatenliste</h1>

<!-- FILTER / SEARCH -->
<div class="filters">
  <input id="search" placeholder="Suche...">
  <select id="filterRace">
    <option value="">Alle Rassen</option>
    <option>Mensch</option><option>Zwerg</option><option>Nachtelf</option>
    <option>Gnom</option><option>Draenei</option>
    <option>Ork</option><option>Troll</option><option>Tauren</option>
    <option>Untoter</option><option>Blutelf</option>
  </select>
  <select id="filterClass">
    <option value="">Alle Klassen</option>
    <option>Krieger</option><option>Paladin</option><option>J√§ger</option>
    <option>Schurke</option><option>Priester</option><option>Schamane</option>
    <option>Magier</option><option>Hexenmeister</option><option>Druide</option>
  </select>
</div>

<div id="mainContent" style="display:none;">
  <div class="form">
    <input id="name" placeholder="Name">
    <select id="race">
      <option value="">Rasse</option>
      <option>Mensch</option>
      <option>Zwerg</option>
      <option>Nachtelf</option>
      <option>Ork</option>
      <option>Untoter</option>
      <option>Tauren</option>
      <option>Blutelf</option>
    </select>
    <select id="wowClass">
      <option value="">Klasse</option>
      <option>Krieger</option>
      <option>Magier</option>
      <option>Priester</option>
      <option>Schurke</option>
      <option>J√§ger</option>
      <option>Hexenmeister</option>
      <option>Druide</option>
      <option>Paladin</option>
      <option>Schamane</option>
    </select>
  </div>
  <div class="form-full">
    <input id="crime" placeholder="Schandtat">
  </div>
  <div class="form-buttons">
    <button id="addBtn">Hinzuf√ºgen</button>
    <button id="logoutBtn">Logout</button>
  </div>

  <div id="list" class="list"></div>

  <div id="adminPanel">
    <h3>Pending-User Freischalten</h3>
    <div id="pendingList"></div>
  </div>
<!-- ADD ENTRY -->
<div class="form">
  <input id="name" placeholder="Name">
  <select id="race"><option value="">Rasse</option>
    <option>Mensch</option><option>Zwerg</option><option>Nachtelf</option>
    <option>Gnom</option><option>Draenei</option>
    <option>Ork</option><option>Troll</option><option>Tauren</option>
    <option>Untoter</option><option>Blutelf</option>
  </select>
  <select id="wowClass"><option value="">Klasse</option>
    <option>Krieger</option><option>Paladin</option><option>J√§ger</option>
    <option>Schurke</option><option>Priester</option><option>Schamane</option>
    <option>Magier</option><option>Hexenmeister</option><option>Druide</option>
  </select>
</div>
<div class="form-full">
  <input id="crime" placeholder="Schandtat">
</div>
<div class="form-buttons">
  <button id="addBtn">Hinzuf√ºgen</button>
</div>

<div id="list"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, doc, getDoc, getDocs, updateDoc, deleteDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import {
  getFirestore, collection, addDoc, query, orderBy, onSnapshot,
  serverTimestamp, doc, updateDoc, increment, getDoc, setDoc
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

/* üî• Firebase Config */
const firebaseConfig = {
  apiKey:"AIzaSyBOko8Wg-jCvz7aRPleNcbJCm8u2CYtjps",
  authDomain:"wow-hs-liste.firebaseapp.com",
  projectId:"wow-hs-liste",
  storageBucket:"wow-hs-liste.firebasestorage.app",
  messagingSenderId:"180764359810",
  appId:"1:180764359810:web:03cef19546dcc32081889b"
  apiKey:"DEIN_API_KEY",
  authDomain:"DEIN_PROJECT.firebaseapp.com",
  projectId:"DEIN_PROJECT_ID",
  appId:"DEINE_APP_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const auth = getAuth(app);

const initialClassData = {
  Krieger:{color:"#C79C6E",role:"Tank",icon:"https://wow.zamimg.com/images/wow/icons/large/class_warrior.jpg"},
  Magier:{color:"#69CCF0",role:"DPS",icon:"https://wow.zamimg.com/images/wow/icons/large/class_mage.jpg"},
  Priester:{color:"#FFFFFF",role:"Heal",icon:"https://wow.zamimg.com/images/wow/icons/large/class_priest.jpg"},
  Schurke:{color:"#FFF569",role:"DPS",icon:"https://wow.zamimg.com/images/wow/icons/large/class_rogue.jpg"},
  J√§ger:{color:"#ABD473",role:"DPS",icon:"https://wow.zamimg.com/images/wow/icons/large/class_hunter.jpg"},
  Hexenmeister:{color:"#9482C9",role:"DPS",icon:"https://wow.zamimg.com/images/wow/icons/large/class_warlock.jpg"},
  Druide:{color:"#FF7D0A",role:"Heal",icon:"https://wow.zamimg.com/images/wow/icons/large/class_druid.jpg"},
  Paladin:{color:"#F58CBA",role:"Heal/DPS",icon:"https://wow.zamimg.com/images/wow/icons/large/class_paladin.jpg"},
  Schamane:{color:"#0070DE",role:"Heal/DPS",icon:"https://wow.zamimg.com/images/wow/icons/large/class_shaman.jpg"}
};

const raceIcons={
Mensch:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_human_male.jpg",
Zwerg:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_dwarf_male.jpg",
Nachtelf:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_nightelf_male.jpg",
Ork:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_orc_male.jpg",
Untoter:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_undead_male.jpg",
Tauren:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_tauren_male.jpg",
Blutelf:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_bloodelf_male.jpg"
};

// DOM
const email=document.getElementById("email");
const password=document.getElementById("password");
const loginPanel=document.getElementById("loginPanel");
const mainContent=document.getElementById("mainContent");
const list=document.getElementById("list");
const nameInput=document.getElementById("name");
const race=document.getElementById("race");
const wowClass=document.getElementById("wowClass");
const crimeInput=document.getElementById("crime");
const adminPanel=document.getElementById("adminPanel");
const pendingList=document.getElementById("pendingList");

// REGISTER
document.getElementById("registerBtn").onclick=async()=>{
  try{
    const cred = await createUserWithEmailAndPassword(auth,email.value,password.value);
    await setDoc(doc(db,"users",cred.user.uid), {email:email.value,role:"pending"});
    alert("Registriert ‚Äì Admin muss freischalten");
    signOut(auth);
  }catch(e){alert("Fehler: "+e.message);}
};
const list = document.getElementById("list");
const search = document.getElementById("search");
const filterRace = document.getElementById("filterRace");
const filterClass = document.getElementById("filterClass");

// LOGIN / LOGOUT
document.getElementById("loginBtn").onclick = () => signInWithEmailAndPassword(auth,email.value,password.value).catch(e=>alert(e.message));
document.getElementById("logoutBtn").onclick = () => signOut(auth);

// AUTH STATE
onAuthStateChanged(auth, async user=>{
  if(!user){ loginPanel.style.display="block"; mainContent.style.display="none"; return;}
  const snap = await getDoc(doc(db,"users",user.uid));
  if(!snap.exists() || snap.data().role==="pending"){ alert("Noch nicht freigeschaltet"); signOut(auth); return; }
  loginPanel.style.display="none"; mainContent.style.display="block";
  const role = snap.data().role;
  if(role==="admin"){ adminPanel.style.display="block"; loadPending(); } else { adminPanel.style.display="none"; }
  loadEntries();
});
let entries = [];

// ADD ENTRY
document.getElementById("addBtn").onclick = async () => {
  const user = auth.currentUser;
  if(!user || !nameInput.value || !race.value || !wowClass.value || !crimeInput.value){ alert("Alle Felder ausf√ºllen"); return;}
/* ADD ENTRY */
addBtn.onclick = async()=>{
  if(!name.value||!race.value||!wowClass.value||!crime.value) return;
await addDoc(collection(db,"entries"),{
    uid:user.uid,
    name:nameInput.value,
    name:name.value,
race:race.value,
class:wowClass.value,
    crime:crimeInput.value,
    role:initialClassData[wowClass.value].role,
    crime:crime.value,
    upvotes:0,
    downvotes:0,
createdAt:serverTimestamp()
});
  nameInput.value=""; race.value=""; wowClass.value=""; crimeInput.value="";
  name.value = crime.value = "";
};

// LOAD ENTRIES
function loadEntries(){
  const q = query(collection(db,"entries"),orderBy("createdAt"));
  onSnapshot(q,snap=>{
    list.innerHTML="";
    snap.forEach(doc=>{
      const e = doc.data();
      const div = document.createElement("div");
      div.className="entry";
      div.style.borderLeftColor = initialClassData[e.class].color;
      div.innerHTML=`
        <div class="icon" style="background-image:url(${raceIcons[e.race]})"></div>
        <div class="icon" style="background-image:url(${initialClassData[e.class].icon})"></div>
        <div>
          <strong>${e.name}</strong><br>
          <small>${e.race} / ${e.class}</small><br>
          <small>Schandtat: ${e.crime}</small>
        </div>
        <button onclick="editEntry('${doc.id}','${e.name}','${e.race}','${e.class}','${e.crime}')">‚úèÔ∏è</button>
        <button onclick="deleteEntry('${doc.id}')">üóë</button>
      `;
      list.appendChild(div);
    });
  });
}
/* LOAD */
onSnapshot(query(collection(db,"entries"),orderBy("createdAt")),(snap)=>{
  entries = snap.docs.map(d=>({id:d.id,...d.data()}));
  render();
});

// EDIT ENTRY
window.editEntry=async(id,name,raceVal,classVal,crime)=>{
  const newName = prompt("Neuer Name:",name);
  const newRace = prompt("Neue Rasse:",raceVal);
  const newClass = prompt("Neue Klasse:",classVal);
  const newCrime = prompt("Neue Schandtat:",crime);
  if(newName && newRace && newClass && newCrime){
    await updateDoc(doc(db,"entries",id),{
      name:newName,
      race:newRace,
      class:newClass,
      crime:newCrime,
      role:initialClassData[newClass].role
    });
  }
};
search.oninput = filterRace.onchange = filterClass.onchange = render;

/* RENDER */
async function render(){
  list.innerHTML="";
  const user = auth.currentUser;
  const s = search.value.toLowerCase();

// DELETE ENTRY
window.deleteEntry = async(id)=>{if(confirm("Eintrag l√∂schen?")) await deleteDoc(doc(db,"entries",id));}

// ADMIN PANEL
async function loadPending(){
  pendingList.innerHTML="";
  const querySnapshot = await getDocs(collection(db,"users"));
  querySnapshot.forEach((docu)=>{
    const u = docu.data();
    if(u.role==="pending"){
      const div=document.createElement("div");
      div.className="adminUser";
      div.innerHTML=`${u.email} <button onclick="approveUser('${docu.id}')">Freischalten</button>`;
      pendingList.appendChild(div);
  for(const e of entries){
    if(
      (filterRace.value && e.race!==filterRace.value) ||
      (filterClass.value && e.class!==filterClass.value) ||
      !(e.name+e.race+e.class+e.crime).toLowerCase().includes(s)
    ) continue;

    let voteType=null;
    if(user){
      const v = await getDoc(doc(db,"entries",e.id,"votes",user.uid));
      if(v.exists()) voteType=v.data().type;
}
  });

    const div=document.createElement("div");
    div.className="entry";
    div.innerHTML=`
      <div class="icon"></div>
      <div class="icon"></div>
      <div>
        <b>${e.name}</b><br>
        ${e.race} / ${e.class}<br>
        <small>Schandtat: ${e.crime}</small>
      </div>
      <div class="voteBox">
        <span class="voteBtn ${voteType==="up"?"active up":""}"
          onclick="vote('${e.id}','up')">üëç</span>
        <span class="voteCount">${e.upvotes||0}</span>
        <span class="voteBtn ${voteType==="down"?"active down":""}"
          onclick="vote('${e.id}','down')">üëé</span>
        <span class="voteCount">${e.downvotes||0}</span>
      </div>
    `;
    list.appendChild(div);
  }
}
window.approveUser = async(uid)=>{await updateDoc(doc(db,"users",uid),{role:"user"}); loadPending();}

/* VOTE ‚Äì 1 pro User */
window.vote = async(id,type)=>{
  const user = auth.currentUser;
  if(!user){ alert("Bitte einloggen"); return; }

  const voteRef = doc(db,"entries",id,"votes",user.uid);
  const entryRef = doc(db,"entries",id);
  const snap = await getDoc(voteRef);

  if(!snap.exists()){
    await setDoc(voteRef,{type});
    await updateDoc(entryRef,{
      [type==="up"?"upvotes":"downvotes"]: increment(1)
    });
  }else{
    const old = snap.data().type;
    if(old===type) return;
    await updateDoc(voteRef,{type});
    await updateDoc(entryRef,{
      [old==="up"?"upvotes":"downvotes"]: increment(-1),
      [type==="up"?"upvotes":"downvotes"]: increment(1)
    });
  }
  render();
};
</script>

</div>
</body>
</html>
