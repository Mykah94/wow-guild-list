<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>WoW Classic / TBC – Schandtatenliste</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&display=swap" rel="stylesheet">
<style>
body {
  margin:0;
  font-family:'Cinzel',serif;
  color:#f5e6c8;
  background: url('https://wow.zamimg.com/images/wow/backgrounds/bg-tbc-01.jpg') no-repeat center center fixed;
  background-size: cover;
}
.container {
  display:grid;
  grid-template-columns:2fr 1fr 1fr;
  grid-gap:20px;
  max-width:1500px;
  margin:30px auto;
  padding:20px;
  background: rgba(10,7,3,0.9);
  border:6px solid #c9a44c;
  border-radius:14px;
}
h1 { grid-column:1 / span 3; text-align:center; color:#ffd36a; margin-bottom:20px; }
input,select,button { padding:10px; background:#120c05; border:2px solid #9c7c3f; color:#f5e6c8; border-radius:6px; font-family:inherit; }
button { cursor:pointer; background:linear-gradient(to bottom,#e0b75a,#8a6b2f); color:#1b1206; font-weight:bold; }
#loginPanel { max-width:400px; margin:20px auto; padding:20px; background:#1a1208; border-radius:12px; grid-column:1 / span 3; }
.form,.filters { display:flex; flex-wrap:wrap; gap:10px; }
.form-full { width:100%; margin-top:10px; }
#crime { flex:1; min-width:100%; }
.form-buttons { display:flex; justify-content:center; gap:12px; margin-top:10px; }
.list { margin-top:30px; overflow-y:auto; max-height:600px; }
.entry { display:grid; grid-template-columns:44px 44px 1fr 170px; gap:12px; align-items:center; padding:12px; background:linear-gradient(180deg,#1a1208,#0d0904); border:2px solid #8c6a32; border-left:8px solid; border-radius:8px; margin-bottom:10px; }
.icon { width:40px; height:40px; background-size:cover; background-position:center; border:2px solid #c9a44c; border-radius:4px; }
.voteBox { display:flex; align-items:center; justify-content:flex-end; gap:6px; }
.voteBtn { font-size:20px; cursor:pointer; opacity:0.5; transition:transform .1s,opacity .1s; }
.voteBtn:hover { transform:scale(1.2); opacity:1; }
.voteBtn.active.up { color:#4CAF50; opacity:1; }
.voteBtn.active.down { color:#E53935; opacity:1; }
.voteCount { min-width:20px; text-align:center; }
#adminPanel,#usersPanel,#historyPanel { background:#1a1208; padding:10px; border-radius:8px; border:2px solid #8c6a32; overflow:auto; max-height:600px; }
#adminPanel { display:none; }
.adminUser { display:flex; justify-content:space-between; margin-bottom:6px; }
.adminUser button { padding:2px 6px; font-size:0.8em; }
#historyList { font-size:0.85em; line-height:1.3em; }
</style>
</head>
<body>
<div class="container">
<h1>WoW Classic / TBC – Schandtatenliste</h1>

<div id="loginPanel">
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Passwort">
  <button id="registerBtn">Registrieren</button>
  <button id="loginBtn">Login</button>
</div>

<div id="mainContent" style="display:none;">
  <div class="filters">
    <input id="search" placeholder="Suche...">
    <select id="filterRace"><option value="">Alle Rassen</option>
      <option>Mensch</option><option>Zwerg</option><option>Nachtelf</option><option>Gnom</option><option>Draenei</option>
      <option>Ork</option><option>Troll</option><option>Tauren</option><option>Untoter</option><option>Blutelf</option>
    </select>
    <select id="filterClass"><option value="">Alle Klassen</option>
      <option>Krieger</option><option>Paladin</option><option>Jäger</option><option>Schurke</option><option>Priester</option>
      <option>Schamane</option><option>Magier</option><option>Hexenmeister</option><option>Druide</option>
    </select>
  </div>

  <div class="form">
    <input id="name" placeholder="Name">
    <select id="race"><option value="">Rasse</option>
      <option>Mensch</option><option>Zwerg</option><option>Nachtelf</option><option>Gnom</option><option>Draenei</option>
      <option>Ork</option><option>Troll</option><option>Tauren</option><option>Untoter</option><option>Blutelf</option>
    </select>
    <select id="wowClass"><option value="">Klasse</option>
      <option>Krieger</option><option>Paladin</option><option>Jäger</option><option>Schurke</option><option>Priester</option>
      <option>Schamane</option><option>Magier</option><option>Hexenmeister</option><option>Druide</option>
    </select>
  </div>

  <div class="form-full">
    <input id="crime" placeholder="Schandtat">
  </div>

  <div class="form-buttons">
    <button id="addBtn">Hinzufügen</button>
    <button id="logoutBtn">Logout</button>
  </div>

  <div class="list" id="list"></div>
  <div id="adminPanel"><h3>Pending-User Freischalten</h3><div id="pendingList"></div></div>
</div>

<div id="usersPanel"><h3>Angemeldete User</h3><div id="userList"></div></div>
<div id="historyPanel"><h3>Update Historie</h3><div id="historyList">Version 1.0 gestartet</div></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, doc, getDoc, getDocs, updateDoc, deleteDoc, setDoc, increment } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey:"AIzaSyBOko8Wg-jCvz7aRPleNcbJCm8u2CYtjps",
  authDomain:"wow-hs-liste.firebaseapp.com",
  projectId:"wow-hs-liste",
  storageBucket:"wow-hs-liste.appspot.com",
  messagingSenderId:"180764359810",
  appId:"1:180764359810:web:03cef19546dcc32081889b"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Klassen / Rassen
const initialClassData={Krieger:{color:"#C79C6E",icon:"https://wow.zamimg.com/images/wow/icons/large/class_warrior.jpg"},Magier:{color:"#69CCF0",icon:"https://wow.zamimg.com/images/wow/icons/large/class_mage.jpg"},Priester:{color:"#FFFFFF",icon:"https://wow.zamimg.com/images/wow/icons/large/class_priest.jpg"},Schurke:{color:"#FFF569",icon:"https://wow.zamimg.com/images/wow/icons/large/class_rogue.jpg"},Jäger:{color:"#ABD473",icon:"https://wow.zamimg.com/images/wow/icons/large/class_hunter.jpg"},Hexenmeister:{color:"#9482C9",icon:"https://wow.zamimg.com/images/wow/icons/large/class_warlock.jpg"},Druide:{color:"#FF7D0A",icon:"https://wow.zamimg.com/images/wow/icons/large/class_druid.jpg"},Paladin:{color:"#F58CBA",icon:"https://wow.zamimg.com/images/wow/icons/large/class_paladin.jpg"},Schamane:{color:"#0070DE",icon:"https://wow.zamimg.com/images/wow/icons/large/class_shaman.jpg"}};
const raceIcons={Mensch:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_human_male.jpg",Zwerg:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_dwarf_male.jpg",Nachtelf:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_nightelf_male.jpg",Gnom:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_gnome_male.jpg",Draenei:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_draenei_male.jpg",Ork:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_orc_male.jpg",Troll:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_troll_male.jpg",Tauren:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_tauren_male.jpg",Untoter:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_undead_male.jpg",Blutelf:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_bloodelf_male.jpg"};

// DOM
const email=document.getElementById("email"),password=document.getElementById("password"),loginPanel=document.getElementById("loginPanel"),mainContent=document.getElementById("mainContent"),list=document.getElementById("list"),nameInput=document.getElementById("name"),race=document.getElementById("race"),wowClass=document.getElementById("wowClass"),crimeInput=document.getElementById("crime"),adminPanel=document.getElementById("adminPanel"),pendingList=document.getElementById("pendingList"),userList=document.getElementById("userList"),historyList=document.getElementById("historyList");
let entries=[];

// --- Hilfsfunktion History ---
function addHistory(msg){const now=new Date(); const div=document.createElement("div"); div.textContent=`[${now.toLocaleTimeString()}] ${msg}`; historyList.prepend(div);}

// --- Funktionen Register/Login/Logout/Auth ---
document.getElementById("registerBtn").onclick=async()=>{
  try{
    const cred = await createUserWithEmailAndPassword(auth,email.value,password.value);
    await setDoc(doc(db,"users",cred.user.uid),{email:email.value,role:"pending"});
    alert("Registriert – Admin muss freischalten");
    signOut(auth);
  }catch(e){alert("Fehler: "+e.message);}
};
document.getElementById("loginBtn").onclick = ()=>signInWithEmailAndPassword(auth,email.value,password.value).catch(e=>alert(e.message));
document.getElementById("logoutBtn").onclick = ()=>signOut(auth);

// --- Auth State ---
onAuthStateChanged(auth, async user=>{
  if(!user){loginPanel.style.display="block"; mainContent.style.display="none"; adminPanel.style.display="none"; userList.innerHTML=""; return;}
  const snap = await getDoc(doc(db,"users",user.uid));
  if(!snap.exists()||snap.data().role==="pending"){alert("Noch nicht freigeschaltet"); signOut(auth); return;}
  loginPanel.style.display="none";
  mainContent.style.display="block";
  loadEntries();
  loadUsers();
  if(snap.data().role==="admin"){adminPanel.style.display="block"; loadPending();} else {adminPanel.style.display="none";}
});

// --- Alle weiteren Funktionen wie addEntry, render, vote, edit/delete, loadPending, approveUser, loadUsers folgen hier ---
</script>
</div>
</body>
</html>
