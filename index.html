<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>WoW Classic / TBC ‚Äì Schandtatenliste</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Cinzel',serif;
  background:
    linear-gradient(rgba(0,0,0,.65),rgba(0,0,0,.85)),
    url("https://images.blz-contentstack.com/v3/assets/blt3452e3b114fab0cd/blt3b0c3d71b77fa1f1/5dc1f1c3c66dfe8a5f35d4db/classic-map.jpg");
  background-size:cover;
  background-attachment:fixed;
  color:#f5e6c8;
}

.container{
  max-width:1400px;
  margin:40px auto;
  padding:30px;
  background:rgba(20,14,7,.95);
  border:6px solid #c9a44c;
  border-radius:14px;
}

h1{text-align:center;color:#ffd36a;}

input,select,button{
  background:#120c05;
  border:2px solid #9c7c3f;
  color:#f5e6c8;
  padding:10px;
  border-radius:6px;
  font-family:inherit;
}

button{
  cursor:pointer;
  background:linear-gradient(#f7d77a,#9a6b2f);
  color:#1b1206;
  font-weight:bold;
}

button:hover{filter:brightness(1.1);}

#loginPanel{
  max-width:400px;
  margin:80px auto;
  padding:25px;
  background:#1a1208;
  border-radius:12px;
  border:3px solid #c9a44c;
}

#mainContent{display:none;}

.filters,.form{display:flex;gap:10px;flex-wrap:wrap;}
.form-full{margin-top:10px;}
.form-buttons{text-align:center;margin-top:15px;}

.entry{
  display:grid;
  grid-template-columns:44px 44px 1fr 180px;
  gap:12px;
  padding:12px;
  margin-bottom:10px;
  background:linear-gradient(#1a1208,#0d0904);
  border:2px solid #8c6a32;
  border-left:8px solid;
  border-radius:8px;
}

.icon{
  width:40px;height:40px;
  background-size:cover;
  border:2px solid #c9a44c;
}

.voteBox{
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  gap:4px;
}

.voteRow{
  display:flex;
  align-items:center;
  gap:6px;
}

.voteBtn{
  font-size:20px;
  cursor:pointer;
  opacity:.5;
}

.voteBtn.active.up{color:#4caf50;opacity:1;}
.voteBtn.active.down{color:#e53935;opacity:1;}

.editRow{
  display:flex;
  gap:6px;
}

.editRow button{
  font-size:12px;
  padding:3px 6px;
}

#adminPanel,#updatePanel{
  background:#120c05;
  border:2px solid #9c7c3f;
  padding:10px;
  border-radius:10px;
  margin-top:20px;
}

#updatePanel{
  position:fixed;
  right:20px;
  top:120px;
  width:260px;
}

.tooltip:hover::after{
  content:attr(data-tip);
  position:absolute;
  background:#0b0b0b;
  border:2px solid #9c7c3f;
  padding:6px;
  color:#ffd36a;
  font-size:12px;
  white-space:nowrap;
  transform:translate(-50%,120%);
}
</style>
</head>

<body>
<div class="container">

<h1>WoW Classic / TBC ‚Äì Schandtatenliste</h1>

<div id="loginPanel">
  <input id="email" placeholder="Email"><br><br>
  <input id="password" type="password" placeholder="Passwort"><br><br>
  <button id="loginBtn">Login</button>
  <button id="registerBtn">Registrieren</button>
</div>

<div id="mainContent">

<div class="filters">
  <input id="search" placeholder="Suche...">
  <select id="filterRace"><option value="">Alle Rassen</option></select>
  <select id="filterClass"><option value="">Alle Klassen</option></select>
</div>

<div class="form">
  <input id="name" placeholder="Name">
  <select id="race"></select>
  <select id="wowClass"></select>
</div>

<div class="form-full">
  <input id="crime" placeholder="Schandtat">
</div>

<div class="form-buttons">
  <button id="addBtn">Hinzuf√ºgen</button>
  <button id="logoutBtn">Logout</button>
</div>

<div id="list"></div>

<div id="adminPanel" style="display:none;">
  <h3>Pending User</h3>
  <div id="pendingList"></div>
</div>

</div>
</div>

<div id="updatePanel">
<h3>Updates</h3>
<ul>
<li>1.0 ‚Äì Grundsystem</li>
<li>1.1 ‚Äì Voting + Icons</li>
<li>1.2 ‚Äì Admin & Pending</li>
<li>1.3 ‚Äì Live Votes + Sounds</li>
</ul>
</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,signOut,onAuthStateChanged} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import {getFirestore,collection,addDoc,doc,getDoc,getDocs,onSnapshot,updateDoc,setDoc,increment,query,orderBy,serverTimestamp} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyBOko8Wg-jCvz7aRPleNcbJCm8u2CYtjps",
 authDomain:"wow-hs-liste.firebaseapp.com",
 projectId:"wow-hs-liste",
 storageBucket:"wow-hs-liste.appspot.com",
 messagingSenderId:"180764359810",
 appId:"1:180764359810:web:03cef19546dcc32081889b"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

const soundUp=new Audio("https://www.myinstants.com/media/sounds/wow-level-up.mp3");
const soundDown=new Audio("https://www.myinstants.com/media/sounds/wow-fail.mp3");

const races=["Mensch","Zwerg","Nachtelf","Gnom","Draenei","Ork","Troll","Tauren","Untoter","Blutelf"];
const classes=["Krieger","Paladin","J√§ger","Schurke","Priester","Schamane","Magier","Hexenmeister","Druide"];

races.forEach(r=>race.innerHTML+=`<option>${r}</option>`);
classes.forEach(c=>wowClass.innerHTML+=`<option>${c}</option>`);
races.forEach(r=>filterRace.innerHTML+=`<option>${r}</option>`);
classes.forEach(c=>filterClass.innerHTML+=`<option>${c}</option>`);

onAuthStateChanged(auth,async u=>{
 if(!u){loginPanel.style.display="block";mainContent.style.display="none";return;}
 const snap=await getDoc(doc(db,"users",u.uid));
 if(!snap.exists()||snap.data().role==="pending"){alert("Noch nicht freigeschaltet");signOut(auth);return;}
 loginPanel.style.display="none";mainContent.style.display="block";
 if(snap.data().role==="admin") loadPending();
 loadEntries();
});

loginBtn.onclick=()=>signInWithEmailAndPassword(auth,email.value,password.value);
registerBtn.onclick=async()=>{
 const c=await createUserWithEmailAndPassword(auth,email.value,password.value);
 await setDoc(doc(db,"users",c.user.uid),{email:email.value,role:"pending"});
 alert("Registriert ‚Äì wartet auf Freigabe");
 signOut(auth);
};
logoutBtn.onclick=()=>signOut(auth);

addBtn.onclick=()=>addDoc(collection(db,"entries"),{
 name:name.value,race:race.value,class:wowClass.value,crime:crime.value,
 up:0,down:0,createdAt:serverTimestamp()
});

function loadEntries(){
 onSnapshot(query(collection(db,"entries"),orderBy("createdAt","desc")),snap=>{
  list.innerHTML="";
  snap.forEach(d=>{
   const e=d.data();
   const div=document.createElement("div");
   div.className="entry";
   div.innerHTML=`
   <div class="icon" style="background-image:url(https://wow.zamimg.com/images/wow/icons/large/achievement_character_${e.race.toLowerCase()}_male.jpg)"></div>
   <div class="icon" style="background-image:url(https://wow.zamimg.com/images/wow/icons/large/class_${e.class.toLowerCase()}.jpg)"></div>
   <div><b>${e.name}</b><br>${e.race} / ${e.class}<br><small>${e.crime}</small></div>
   <div class="voteBox">
    <div class="voteRow">
     <span onclick="vote('${d.id}','up')" class="voteBtn">üëç</span>${e.up}
     <span onclick="vote('${d.id}','down')" class="voteBtn">üëé</span>${e.down}
    </div>
   </div>`;
   list.appendChild(div);
  });
 });
}

window.vote=async(id,type)=>{
 const u=auth.currentUser;if(!u)return;
 const vRef=doc(db,"entries",id,"votes",u.uid);
 const eRef=doc(db,"entries",id);
 const s=await getDoc(vRef);
 if(s.exists())return;
 await setDoc(vRef,{type});
 await updateDoc(eRef,{[type]:increment(1)});
 (type==="up"?soundUp:soundDown).play();
};

async function loadPending(){
 const s=await getDocs(collection(db,"users"));
 adminPanel.style.display="block";
 pendingList.innerHTML="";
 s.forEach(d=>{
  if(d.data().role==="pending"){
   pendingList.innerHTML+=`${d.data().email} <button onclick="approve('${d.id}')">‚úî</button><br>`;
  }
 });
}
window.approve=uid=>updateDoc(doc(db,"users",uid),{role:"user"}).then(loadPending);
</script>
</body>
</html>
